<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Simple Drop</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      background: #ffffff;
      touch-action: none; 
    }
    canvas {
      position: fixed; inset: 0; display: block;
      width: 100%; height: 100%; cursor: grab;
    }
    canvas:active { cursor: grabbing; }
    
    #intro {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      pointer-events: none;
      font-size: 1.2rem; color: #555; 
      transition: opacity 0.3s ease; z-index: 5;
      background: rgba(255,255,255,0.8);
    }
    #intro.hidden { opacity: 0; pointer-events: none; }
  </style>
</head>
<body>

  <canvas id="canvas"></canvas>

  <div id="intro">
    <div><b>í™”ë©´ì„ í´ë¦­í•˜ë©´ ì‹œì‘í•©ë‹ˆë‹¤</b></div>
  </div>

  <script>
    // =================================================================
    // ğŸ”¥ ê¹”ë”í•˜ê²Œ ì´ˆê¸°í™”: icon í´ë”ì˜ 1.png ~ 15.png ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤ ğŸ”¥
    // ìƒì„¸ì„¤ëª…/íŒì—… ê¸°ëŠ¥ ë‹¤ ëºìŠµë‹ˆë‹¤.
    // =================================================================
    const works = [];
    for (let i = 1; i <= 15; i++) {
      works.push({
        id: i,
        // icon í´ë” ì•ˆì˜ ì´ë¯¸ì§€
        imageSrc: './icon/' + i + '.png' 
      });
    }

    const Engine = Matter.Engine,
          Bodies = Matter.Bodies,
          Composite = Matter.Composite,
          Body = Matter.Body,
          Mouse = Matter.Mouse,
          MouseConstraint = Matter.MouseConstraint;

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const intro = document.getElementById('intro');

    // ì´ë¯¸ì§€ ë¯¸ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
    const loadedImages = {};
    let loadedCount = 0;

    function preloadImages(callback) {
      if (works.length === 0) { callback(); return; }
      
      works.forEach(work => {
        const img = new Image();
        // ë¡œì»¬/ê¹ƒí—ˆë¸Œìš©ì´ë¼ crossOrigin ì‚­ì œí•¨
        
        img.onerror = () => {
          // ì´ë¯¸ì§€ê°€ ì—†ì–´ë„ ë©ˆì¶”ì§€ ì•Šê³  ë¹¨ê°„ ë°•ìŠ¤ë¡œë¼ë„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì¹´ìš´íŠ¸ ì˜¬ë¦¼
          console.warn("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: " + work.imageSrc);
          loadedCount++; 
          if(loadedCount === works.length) callback();
        };
        
        img.onload = () => {
          loadedCount++;
          if(loadedCount === works.length) callback();
        };
        
        img.src = work.imageSrc;
        loadedImages[work.id] = img;
      });
    }

    // ë¬¼ë¦¬ ì—”ì§„ ì„¤ì •
    const engine = Engine.create({ enableSleeping: false });
    const world = engine.world;
    engine.gravity.y = 2; // ì ë‹¹í•œ ì¤‘ë ¥

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      createWalls();
    }
    window.addEventListener('resize', resizeCanvas);

    let walls = [];
    function createWalls() {
      Composite.remove(world, walls);
      const w = window.innerWidth;
      const h = window.innerHeight;
      const thick = 200; 
      
      walls = [
        Bodies.rectangle(w/2, h + thick/2 - 50, w * 2, thick, { isStatic: true }), // ë°”ë‹¥
        Bodies.rectangle(-thick/2, h/2, thick, h * 2, { isStatic: true }), // ì™¼ìª½ ë²½
        Bodies.rectangle(w + thick/2, h/2, thick, h * 2, { isStatic: true }) // ì˜¤ë¥¸ìª½ ë²½
      ];
      Composite.add(world, walls);
    }

    function spawnBoxes() {
      const w = window.innerWidth;
      const baseSize = w < 600 ? 100 : 150; 

      works.forEach((work) => {
        const img = loadedImages[work.id];
        let width = baseSize;
        let height = baseSize;

        // ì´ë¯¸ì§€ ë¹„ìœ¨ëŒ€ë¡œ í¬ê¸° ì¡°ì ˆ
        if (img && img.complete && img.naturalWidth !== 0) {
           const aspect = img.naturalHeight / img.naturalWidth;
           width = baseSize;
           height = width * aspect;
        }

        const x = Math.random() * (w - 200) + 100;
        const y = -Math.random() * 1000 - 100;

        const body = Bodies.rectangle(x, y, width, height, {
          restitution: 0.5,
          friction: 0.1,
          angle: Math.random() * Math.PI,
          customData: { img: img, w: width, h: height, src: work.imageSrc } // ë°ì´í„° ì €ì¥
        });
        
        Composite.add(world, body);
      });
    }

    // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ ê¸°ëŠ¥ ì¶”ê°€
    const mouse = Mouse.create(canvas);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: { stiffness: 0.2, render: { visible: false } }
    });
    Composite.add(world, mouseConstraint);
    mouse.element.removeEventListener("mousewheel", mouse.mousewheel);
    mouse.element.removeEventListener("DOMMouseScroll", mouse.mousewheel);

    // ë Œë”ë§ ë£¨í”„
    function render() {
      Engine.update(engine, 1000 / 60);
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const bodies = Composite.allBodies(world);
      
      for (let i = 0; i < bodies.length; i++) {
        const body = bodies[i];
        if (body.isStatic) continue; // ë²½ì€ ê·¸ë¦¬ì§€ ì•ŠìŒ

        const { x, y } = body.position;
        const angle = body.angle;
        const { img, w, h, src } = body.customData || {};

        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(angle);

        if (img && img.complete && img.naturalWidth !== 0) {
          ctx.drawImage(img, -w/2, -h/2, w, h);
        } else {
          // ì´ë¯¸ì§€ê°€ ê¹¨ì§€ê±°ë‚˜ ê²½ë¡œê°€ í‹€ë ¸ìœ¼ë©´ ë¹¨ê°„ ë°•ìŠ¤ í‘œì‹œ (ë””ë²„ê¹…ìš©)
          ctx.fillStyle = 'red';
          ctx.fillRect(-w/2, -h/2, w, h);
          ctx.fillStyle = 'white';
          ctx.font = '12px sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText("X", 0, 5);
        }
        
        ctx.restore();
      }
      requestAnimationFrame(render);
    }

    // ì‹œì‘
    function start() {
      intro.classList.add('hidden');
      resizeCanvas();
      spawnBoxes();
      render();
    }

    preloadImages(() => {
      document.body.addEventListener('click', start, { once: true });
      document.body.addEventListener('touchstart', start, { once: true });
    });

  </script>
</body>
</html>
